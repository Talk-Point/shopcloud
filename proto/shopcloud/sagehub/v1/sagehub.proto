// SageHub API
// To access the erp

syntax = "proto3";

package proto.shopcloud.sagehub.v1;

import "google/protobuf/timestamp.proto";

// Generic
enum Operator {
    OPERATOR_EQUAL_UNSPECIFIED = 0;
    // OPERATOR_NOT_EQUAL = 1;
    OPERATOR_GREATER_THAN = 2;
    OPERATOR_GREATER_THAN_OR_EQUAL = 3;
    OPERATOR_LESS_THAN = 4;
    OPERATOR_LESS_THAN_OR_EQUAL = 5;
    // OPERATOR_IN = 6;
    // OPERATOR_NOT_IN = 7;
    // OPERATOR_LIKE = 8;
    // OPERATOR_NOT_LIKE = 9;
    // OPERATOR_IS_NULL = 10;
    // OPERATOR_IS_NOT_NULL = 11;
    OPERATOR_CONTAINS = 12;
    OPERATOR_ARRAY_CONTAINS = 13;
}

enum Direction {
    DIRECTION_ASC_UNSPECIFIED = 0;
    DIRECTION_DESC = 1;
}

// Scopes
enum Scope {
    SCOPE_UNSPECIFIED = 0;
    SCOPE_READ = 1;
    SCOPE_WRITE = 2;
    SCOPE_ADMIN = 3;
}

// Models
message ActionItem {
    string reference = 1;
    string value = 2;
}

message Action {
    enum Type {
        TYPE_ADD_UNSPECIFIED = 0;
        TYPE_UPDATE = 1;
        TYPE_DELETE = 2;
    }

    string id = 1;
    Type type = 2;
    string table = 3;
    repeated ActionItem items = 4;
    string by_user = 5;
    google.protobuf.Timestamp created_at = 6;
}

message ApiKey {
    string id = 1;
    string username = 2;
    string email = 3;
    repeated Scope scopes = 4;
    string secret = 5;
    google.protobuf.Timestamp created_at = 6;
    google.protobuf.Timestamp updated_at = 7;
}

message LBAmazonItem {
    int64 item_id = 1;
    int32 mandant = 2;
    string artikelnummer = 3;
    int64 auspraegung_id = 4;
    string title = 5;
    string sku = 6;
    string asin = 7;
    string marketplace_id = 8;
    int32 leadtime_to_ship = 9;
}

message Event {
    string id = 1;
    string ressource = 2;
    string reference = 3;
    string topic = 4;
    google.protobuf.Timestamp ttl = 5;
    google.protobuf.Timestamp created_at = 6;
}

message Feed {
    string id = 1;
    string supplier = 2;
    string name = 3;
    string source = 4;
    google.protobuf.Timestamp created_at = 5;
    google.protobuf.Timestamp update_at = 6;

    message HttpSource {
        string url = 1;
    }
    
    message FtpSource {
        string host = 1;
        int32 port = 2;
        string username = 3;
        string password = 4;
        string remote_path = 5;
    }
}

service SageHubService {
    // Info
    rpc Info(InfoRequest) returns (InfoResponse);

    // Actions
    rpc GetAction(GetActionRequest) returns (GetActionResponse);
    rpc ListActions(ListActionsRequest) returns (ListActionsResponse);

    // APIKeys
    rpc GetApiKey(GetApiKeyRequest) returns (GetApiKeyResponse);
    rpc ListApiKeys(ListApiKeysRequest) returns (ListApiKeysResponse);
    rpc CreateApiKey(CreateApiKeyRequest) returns (CreateApiKeyResponse);
    rpc DeleteApiKey(DeleteApiKeyRequest) returns (DeleteApiKeyResponse);
    rpc UpdateScopesByApiKey(UpdateScopesByApiKeyRequest) returns (UpdateScopesByApiKeyResponse);

    // Events
    rpc GetEvent(GetEventRequest) returns (GetEventResponse);
    rpc DeleteEvent(DeleteEventRequest) returns (DeleteEventResponse);
    rpc PushEvent(PushEventRequest) returns (PushEventResponse);

    // Amazon
    rpc GetAmazonItem(GetAmazonItemRequest) returns (GetAmazonItemResponse);
    rpc UpdateAmazonLeadTimes(UpdateAmazonLeadTimesRequest) returns (UpdateAmazonLeadTimesResponse);

    // VKBelege
    rpc GetVKBelegV2(GetVKBelegV2Request) returns (GetVKBelegV2Response);
    // VKBelegEvents
    rpc FetchNewestVKBelegEvents(FetchNewestVKBelegEventsRequest) returns (FetchNewestVKBelegEventsResponse);
    rpc BatchEmitVKBelegEvents(BatchEmitVKBelegEventsRequest) returns (BatchEmitVKBelegEventsResponse);
    rpc EmitVKBelegEvents(EmitVKBelegEventsRequest) returns (EmitVKBelegEventsResponse);
    rpc ListVKBelegEvents(ListVKBelegEventsRequest) returns (ListVKBelegEventsResponse);
    rpc GetVKBelegEvent(GetVKBelegEventRequest) returns (GetVKBelegEventResponse);
    // VKBelegPulse
    rpc GetVKBelegPulse(GetVKBelegPulseRequest) returns (GetVKBelegPulseResponse);

    // Feeds
    rpc GetFeed(GetFeedRequest) returns (GetFeedResponse);
    rpc ListFeeds(ListFeedsRequest) returns (ListFeedsResponse);
    rpc ListFeedFiles(ListFeedFilesRequest) returns (ListFeedFilesResponse);
    rpc CreateFeed(CreateFeedRequest) returns (CreateFeedResponse);
    rpc CreateFeedFile(CreateFeedFileRequest) returns (CreateFeedFileResponse);
    rpc DeleteFeed(DeleteFeedRequest) returns (DeleteFeedResponse);

    // Articles
    // Articles Prices
    rpc ListArticlesPriceLists(ListArticlesPriceListsRequest) returns (ListArticlesPriceListsResponse);
    rpc GetArticlePrices(GetArticlePricesRequest) returns (GetArticlePricesResponse);
    rpc UpdateArticlePrice(UpdateArticlePriceRequest) returns (UpdateArticlePriceResponse);
}

message PriceList {
    int32 mandant = 1;
    int64 id = 2;
    string name = 3;
    string currency = 4;
    bool is_brutto_price = 5;
}

message ListArticlesPriceListsRequest {
    int32 mandant = 1;
    int32 page_size = 2;
    int32 page = 3;
}

message ListArticlesPriceListsResponse {
    repeated PriceList price_lists = 1;
}

message GetArticlePricesRequest {
    int32 mandant = 1;
    string artikelnummer = 2;
    int32 auspraegung_id = 3;
}

message ArticlePrice {
    int32 mandant = 1;
    string artikelnummer = 2;
    int32 auspraegung_id = 3;
    int64 list = 4;
    string list_name = 5;
    double price = 6;
    string currency = 7;
}

message GetArticlePricesResponse {
    repeated ArticlePrice prices = 1;
}

message UpdateArticlePriceRequest {
    int32 mandant = 1;
    string artikelnummer = 2;
    int32 auspraegung_id = 3;
    int64 list = 4;
    double price = 5;
    string by_user_id = 6;
    string by_user_name = 7;
}

message UpdateArticlePriceResponse {}

message CreateFeedFileRequest {
    string feed = 1;
    string filename = 2;
    bytes content = 3;
}

message CreateFeedFileResponse {
    string uri = 1;
}

message GetFeedRequest {
    string id = 1;
}

message GetFeedResponse {
    Feed feed = 1;
}

message ListFeedsFilter {
    enum Field {
        FIELD_ID_UNSPECIFIED = 0;
        FIELD_NAME = 1;
        FIELD_CREATED_AT = 2;
    }

    Field field = 1;
    string value = 2;
    Operator operator = 3;
}

message ListFeedsRequest {
    enum OrderBy {
        ORDER_BY_ID_UNSPECIFIED = 0;
        ORDER_BY_CREATED_AT = 1;
    }

    int32 page_size = 1;
    string page_next = 2;
    string page_previous = 3;
    OrderBy order_by = 4;
    Direction direction = 5;
    repeated ListFeedsFilter filters = 6;
}

message ListFeedsResponse {
    repeated Feed feeds = 1;
    string page_token = 2;
}

message ListFeedFilesRequest {
    string id = 1;
    string date_suffix = 2;
}

message ListFeedFilesResponse {
    repeated string uris = 1;
}

message CreateFeedRequest {
    string supplier = 1;
    string name = 2;
    oneof source {
        Feed.HttpSource http = 3;
        Feed.FtpSource ftp = 4;
    }
}

message CreateFeedResponse {
    Feed feed = 1;
}

message DeleteFeedRequest {
    string id = 1;
}

message DeleteFeedResponse {
    Feed feed = 1;
}

enum VKBelegart {
    VK_BELEGART_UNSPECIFIED = 0;
    VK_BELEGART_AUFTRAGSBESTAETIGUNG = 1;
    VK_BELEGART_KOMMISSIONIERAUFTRAG = 2;
    VK_BELEGART_KOMMISSIONIERRECHNUNG = 3;
    VK_BELEGART_SOFORTRECHNUNG = 4;
    VK_BELEGART_RECHNUNG = 5;
    VK_BELEGART_SOFORTSTORNORECHNUNG = 6;
    VK_BELEGART_LIEFERSCHEIN = 7;
    VK_BELEGART_KOMMISSIONIERLIEFERSCHEIN = 8;
    VK_BELEGART_STORNORECHNUNG = 9;
    VK_BELEGART_GUTSCHRIFT = 10;
    VK_BELEGART_RUECKLIEFERSCHEIN = 11;
    VK_BELEGART_KOMMISSIONIERABSCHLUSSLIEFERSCHEIN = 12;
    VK_BELEGART_STRECKENLIEFERSCHEIN = 13;
    VK_BELEGART_ANGEBOT = 14;
    VK_BELEGART_STRECKENRUECKLIEFERSCHEIN = 15;
    VK_BELEGART_DIREKTRECHNUNG = 16;
    VK_BELEGART_PROFORMARECHNUNG = 17;
    VK_BELEGART_STRECKENSOFORTRECHNUNG = 18;
    VK_BELEGART_FILIAL_LIEFERSCHEIN = 19;
    VK_BELEGART_STRECKENSOFORTSTORNORECHNUNG = 20;
    VK_BELEGART_SOFORTAUFTRAG = 21;
    VK_BELEGART_FILIAL_AUFTRAGSBESTAETIGUNG = 22;
    VK_BELEGART_SAMMELRECHNUNG = 23;
    VK_BELEGART_MUSTERBELEG = 24;
}

message BatchEmitVKBelegEventsRequest {
    int32 mandant = 1;
    repeated int64 bel_ids = 2;
}

message BatchEmitVKBelegEventsResponse {
    int64 success_total = 1;
    repeated string bel_ids_with_error = 2;
}

message GetVKBelegPulseRequest {
    int32 mandant = 1;
    string start_at = 2; // 2024-05-13T00:00:00+02:00
    string end_at = 3;
    repeated VKBelegart belegart_items = 4;
}

message VKBelegPulseV1 {
    int32 mandant = 1;
    string kundengruppe = 2;
    int32 orders = 3;
    double turnover = 4;
    double product_qty = 5;
    double product_turnover = 6;
    double product_profit = 7;

    message Metrics {
        int32 orders = 1;
        double turnover = 2;
        double product_qty = 3;
        double product_turnover = 4;
        double product_profit = 5;
    }

    message Filters {
        int32 mandant = 1;
        string start_at = 2;
        string end_at = 3;
        repeated string belegart_items = 4;
    }
}

message GetVKBelegPulseResponse {
    int32 page_size = 1;
    int32 page = 2;
    int32 mandant = 3;
    repeated VKBelegPulseV1 items = 4;
    VKBelegPulseV1.Metrics metrics = 5;
    VKBelegPulseV1.Filters filters = 6;
}

message FetchNewestVKBelegEventsRequest {
    int32 mandant = 1;
    int64 bel_id = 2;
}

message FetchNewestVKBelegEventsResponse {
    repeated int64 bel_ids = 1;
}

message EmitVKBelegEventsRequest {
    int32 mandant = 3;
    int64 bel_id = 4;
}

message EmitVKBelegEventsResponse {
    repeated EventItemVkBeleg events = 1;
}

enum EventTopic {
    EVENT_TOPIC_UNKNOW_UNSPECIFIED = 0;
    EVENT_TOPIC_VK_BELEG_CREATED = 1;
    EVENT_TOPIC_VK_BELEG_PAYED = 2;
    EVENT_TOPIC_VK_BELEG_OVER_PAYED = 3;
    EVENT_TOPIC_VK_BELEG_UNDER_PAYED = 4;
    EVENT_TOPIC_VK_BELEG_MAHNSTUFE_1 = 5;
    // EVENT_VK_BELEG_TOPIC_MAHNSTUFE_2 = 6;
    // EVENT_VK_BELEG_TOPIC_MAHNSTUFE_3 = 7;
    EVENT_TOPIC_VK_BELEG_CANCELD = 8;
    EVENT_TOPIC_VK_BELEG_FULFILLED = 9;
    EVENT_TOPIC_FEED_FILE_CREATED = 10;
}

message EventItemVkBeleg {
    string id = 1;
    EventTopic topic = 2;
    int32 mandant = 3;
    int64 bel_id = 4;
    google.protobuf.Timestamp created_at = 5;
}

message ListVKBelegEventsRequest{
    int32 mandant = 1;
    int64 bel_id = 2;
    string page_token = 3;
}

message ListVKBelegEventsResponse {
    repeated EventItemVkBeleg events = 1;
    string page_token = 2;
}

message GetVKBelegEventRequest {
    int32 mandant = 1;
    int64 bel_id = 2;
    EventTopic topic = 3;
}

// EVENT_VK_BELEG_TOPIC_CREATED
message EventVkBelegCreated {
    EventTopic topic = 1;
    VKBelegV2 beleg = 2;
    repeated VKBelegePositionenV2 positions = 3;
    repeated VKBelegeWarehousePositionV1 warehouse_positions = 4;
    google.protobuf.Timestamp beleg_created_at = 5;
    google.protobuf.Timestamp created_at = 6;
}

// EVENT_VK_BELEG_TOPIC_PAYED
message EventVkBelegPayed {
    EventTopic topic = 1;
    int32 mandant = 2;
    int64 bel_id = 3;
    int64 vor_id = 4;
    string belegart = 5;
    string kundengruppe = 6;
    string referenznummer = 7;
    string zahlungskond = 8;
    string user_zahlungsreferenz = 9;
    google.protobuf.Timestamp created_at = 10;
}

// EVENT_VK_BELEG_TOPIC_OVER_PAYED
message EventVkBelegOverPayed {
    EventTopic topic = 1;
    int32 mandant = 2;
    int64 bel_id = 3;
    int64 vor_id = 4;
    string belegart = 5;
    string kundengruppe = 6;
    string referenznummer = 7;
    string zahlungskond = 8;
    string user_zahlungsreferenz = 9;
    google.protobuf.Timestamp created_at = 10;
}

// EVENT_VK_BELEG_TOPIC_UNDER_PAYED
message EventVkBelegUnderPayed {
    EventTopic topic = 1;
    int32 mandant = 2;
    int64 bel_id = 3;
    int64 vor_id = 4;
    string belegart = 5;
    string kundengruppe = 6;
    string referenznummer = 7;
    string zahlungskond = 8;
    string user_zahlungsreferenz = 9;
    google.protobuf.Timestamp created_at = 10;
}

// EVENT_VK_BELEG_MAHNSTUFE_1
message EventVkBelegMahnstufe1 {
    EventTopic topic = 1;
    int32 mandant = 2;
    int64 bel_id = 3;
    int64 vor_id = 4;
    string belegart = 5;
    string kundengruppe = 6;
    string referenznummer = 7;
    string zahlungskond = 8;
    string user_zahlungsreferenz = 9;
    google.protobuf.Timestamp created_at = 10;
}

// EVENT_TOPIC_VK_BELEG_CANCELD
message EventVkBelegCanceled {
    EventTopic topic = 1;
    int32 mandant = 2;
    int64 bel_id = 3;
    int64 vor_id = 4;
    string belegart = 5;
    string kundengruppe = 6;
    string referenznummer = 7;
    string zahlungskond = 8;
    string user_zahlungsreferenz = 9;
    string user_kopftext = 10;
    repeated string user_tags = 11;
    google.protobuf.Timestamp created_at = 12;
}

// EVENT_TOPIC_FEED_FILE_CREATED
message EventFeedFileCreated {
    EventTopic topic = 1;
    string feed = 2;
    string supplier = 3;
    string name = 4;
    string uri = 5;
    int64 size = 6;
    string size_humanized = 7;
    google.protobuf.Timestamp created_at = 8;
}

message GetVKBelegEventResponse {
    oneof event {
        EventVkBelegCreated created = 1;
        EventVkBelegPayed payed = 2;
        EventVkBelegOverPayed over_payed = 3;
        EventVkBelegUnderPayed under_payed = 4;
        EventVkBelegMahnstufe1 mahnstufe_1 = 5;
        // EventVkBelegMahnstufe1 mahnstufe_2 = 6;
        // EventVkBelegMahnstufe1 mahnstufe_3 = 7;
        EventVkBelegCanceled canceled = 8;
    }
}

message PushEventRequest {
    string id = 1;
}

message PushEventResponse {
    Event event = 1;
}

message GetEventRequest {
    string id = 1;
}

message GetEventResponse {
    Event event = 1;
}

message DeleteEventRequest {
    string id = 1;
}

message DeleteEventResponse {
    Event event = 1;
}

enum PayedStatus {
    PAYED_STATUS_UNKNOW_UNSPECIFIED = 0;
    PAYED_STATUS_NOT_PAID = 1;
    PAYED_STATUS_PAID = 2;
    PAYED_STATUS_UNDERPAID = 3;
    PAYED_STATUS_OVERPAID = 4;
}

enum MahnstufeStatus {
    MAHNSTUFE_STATUS_UNKNOW_UNSPECIFIED = 0;
    MAHNSTUFE_STATUS_0 = 1;
    MAHNSTUFE_STATUS_1 = 2;
    MAHNSTUFE_STATUS_2 = 3;
    MAHNSTUFE_STATUS_3 = 4;
}

message VKBelegV2 {
    int32 mandant = 1;
    int64 vor_id = 2;
    int64 bel_id = 3;
    string belegkennzeichen = 4;
    string belegart = 5;
    string kundengruppe = 6;
    string kopftext = 7;
    string referenznummer = 8;
    string lieferbedingung = 9;
    string user_kom_bearbeiter = 10;
    google.protobuf.Timestamp user_kom_zeit = 11;
    string user_zahlungsreferenz = 12;
    google.protobuf.Timestamp user_cd = 13;
    string user_belegjahr_belegnummer = 14;
    double nettobetrag_ew = 15;
    double bruttobetrag_ew = 16;
    string versand = 17;
    PayedStatus user_bezahlt = 18;
    string zahlungskond = 19;
    string inkassoart = 20;
    double betrag = 21;
    string email = 22;
    string telefon = 23;
    string a0_land = 24;
    string a1_land = 25;
    string memo = 26;
    repeated string tags = 27;
    MahnstufeStatus user_mahnstufe = 28;
    double roherloes = 29;
    repeated string suppliers = 30;
}

message VKBelegePositionenV2 {
    int64 bel_pos_id = 1;
    int64 vor_pos_id = 2;
    string position = 3;
    string artikelnummer = 4;
    int32 auspraegung_id = 5;
    string bezeichnung_1 = 6;
    string bezeichnung_2 = 7;
    double gesamtpreis_intern_ew = 8;
    double einzelpreis = 9;
    double mittlerer_ek = 10;
    double roherloes = 11;
    double menge = 12;
    bool ist_erledigt = 13;
    string mengeneinheit = 14;
    string menge_vp_einheit = 15;
    bool user_sonepar_bestellt = 16;
    google.protobuf.Timestamp user_sonepar_bestellt_markiert_datum = 17;
    bool user_ep_bestellt = 18;
    google.protobuf.Timestamp user_ep_bestellt_markiert_datum = 19;
    string user_versandklasse = 20;
    string user_sonepar_artikel = 21;
    string user_zulieferer_code = 22;
    string user_zulieferer_artikelnummer = 23;
    double user_zulieferer_bestand = 24;
}

message VKBelegeWarehousePositionV1 {
    int32 mandant = 1;
    string artikelnummer = 2;
    int32 auspraegung_id = 3;
    double menge = 4;
    string mengeneinheit = 5;
    string menge_vp_einheit = 6;
    double menge_vp_umrechnung = 7;
    double lagerbestand = 8;
    double dispobestand = 9;
}

message GetVKBelegV2Request {
    int32 mandant = 1;
    int64 bel_id = 2;
}

message GetVKBelegV2Response {
    VKBelegV2 beleg = 1;
    repeated VKBelegePositionenV2 positions = 2;
    repeated VKBelegeWarehousePositionV1 warehouse_positions = 3;
}

message GetApiKeyRequest {
    string id = 1;
}

message GetApiKeyResponse {
    ApiKey api_key = 1;
}

message ListApiKeysFilter {
    enum Field {
        FIELD_ID_UNSPECIFIED = 0;
        FIELD_USERNAME = 1;
        FIELD_EMAIL = 2;
        FIELD_SECRET = 3;
        FIELD_BY_USER_NAME = 4;
        FIELD_CREATED_AT = 5;
    }

    Field field = 1;
    string value = 2;
    Operator operator = 3;
}

message ListApiKeysRequest {
    enum OrderBy {
        ORDER_BY_ID_UNSPECIFIED = 0;
        ORDER_BY_CREATED_AT = 1;
    }

    int32 page_size = 1;
    string page_next = 2;
    string page_previous = 3;
    OrderBy order_by = 4;
    Direction direction = 5;
    repeated ListApiKeysFilter filters = 6;
}

message ListApiKeysResponse {
    repeated ApiKey api_keys = 1;
    string page_token = 2;
}

message CreateApiKeyRequest {
    string username = 1;
    string email = 2;
    repeated Scope scopes = 3;
}

message CreateApiKeyResponse {
    ApiKey api_key = 1;
}

message DeleteApiKeyRequest {
    string id = 1;
}

message DeleteApiKeyResponse {
    ApiKey api_key = 1;
}

message UpdateScopesByApiKeyRequest {
    string id = 1;
    repeated string scopes = 2;
}

message UpdateScopesByApiKeyResponse {
    ApiKey api_key = 1;
}

message UpdateAmazonItemLeadTimeToShipItem {
    int32 mandant = 1;
    int64 item_id = 2;
    int32 lead_time_to_ship = 3;
}

message UpdateAmazonLeadTimesRequest {
    repeated UpdateAmazonItemLeadTimeToShipItem items = 1;
}

message UpdateAmazonLeadTimesResponse {
    bool is_success = 1;
}

message GetAmazonItemRequest {
    int32 mandant = 1;
    int64 item_id = 2;
}

message GetAmazonItemResponse {
    LBAmazonItem item = 1;
}

message GetActionRequest {
    string id = 1;
}

message GetActionResponse {
    Action action = 1;
}

message ListActionsFilter {
    enum Field {
        FIELD_ID_UNSPECIFIED = 0;
        FIELD_TYPE = 1;
        FIELD_TABLE = 2;
        FIELD_BY_USER_ID = 3;
        FIELD_BY_USER_NAME = 4;
        FIELD_CREATED_AT = 5;
    }

    Field field = 1;
    string value = 2;
    Operator operator = 3;
}

message ListActionsRequest {
    enum OrderBy {
        ORDER_BY_ID_UNSPECIFIED = 0;
        ORDER_BY_CREATED_AT = 1;
    }

    int32 page_size = 1;
    string page_next = 2;
    string page_previous = 3;
    OrderBy order_by = 4;
    Direction direction = 5;
    repeated ListActionsFilter filters = 6;
}

message ListActionsResponse {
    repeated Action actions = 1;
    string page_token = 2;
}

message InfoRequest {}

message InfoResponse {
    string version = 1;
}